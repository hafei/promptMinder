############
# 🔐 密钥配置
# ⚠️ 生产环境必须修改以下所有密钥！
############

# 📌 PostgreSQL 数据库密码（被多个服务使用：db, studio, auth, rest, realtime, storage, meta, analytics, functions, supavisor）
POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password

# 📌 JWT 密钥（至少32字符）
# 用于: auth服务签发JWT, rest/storage/realtime/functions/supavisor验证JWT, studio显示配置
JWT_SECRET=super-secret-jwt-key-with-at-least-32-characters-1234

# 📌 匿名用户 JWT Token（用于未登录用户访问公开 API）
# 用于: kong网关验证, storage服务, studio配置, realtime健康检查, functions服务
# ⚠️ 必须使用 JWT_SECRET 签发，role=anon
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzY1NjM0MDMyLCJleHAiOjE3OTcxNzAwMzJ9.EY31L6e8y5KYrnwQ5zRVhK415wY_lb8Mu1BwVd88BV0

# 📌 服务端 JWT Token（具有完全数据库访问权限，绕过 RLS）
# 用于: kong网关验证, storage服务, studio配置, functions服务
# ⚠️ 必须使用 JWT_SECRET 签发，role=service_role
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoic2VydmljZV9yb2xlIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NjU2MzQwMzIsImV4cCI6MTc5NzE3MDAzMn0.CicU89LY8wgYgP6yAldIfveaqHZ1FQxD1hqfnaQ7YVc

# 📌 Supabase Studio 登录凭证
# 用于: kong网关的 basic-auth 插件验证 Studio 访问
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=this_password_is_insecure_and_should_be_updated

# 📌 Realtime 服务密钥（用于 cookie 签名和加密）
# 用于: realtime服务, supavisor服务
SECRET_KEY_BASE=UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq

# 📌 Vault 加密密钥（32字符）
# 用于: supavisor服务的数据加密
VAULT_ENC_KEY=your-32-character-encryption-key

# 📌 PostgreSQL Meta 服务加密密钥（32字符以上）
# 用于: meta服务, studio服务的数据加密
PG_META_CRYPTO_KEY=your-encryption-key-32-chars-min


############
# 🗄️ 数据库配置
# 用于连接 PostgreSQL 数据库的基础配置
############

# 📌 数据库主机名（Docker 内部使用容器名）
# 用于: studio, auth, rest, realtime, storage, meta, analytics, supavisor
POSTGRES_HOST=db

# 📌 数据库名称
# 用于: studio, auth, rest, realtime, storage, meta, analytics, db, supavisor
POSTGRES_DB=postgres

# 📌 数据库端口（Docker 内部端口）
# 用于: studio, auth, rest, realtime, storage, meta, analytics, db, supavisor
# ⚠️ 这是容器内部端口，supavisor 会将此端口映射到宿主机
POSTGRES_PORT=5432


############
# 🔄 Supavisor - 数据库连接池
# 用于提高数据库连接效率和管理
############

# 📌 事务池代理端口
# 用于: supavisor服务暴露给外部的连接池端口
# 🌐 外部访问: 应用程序可以通过 host:6543 连接数据库（使用事务池模式）
POOLER_PROXY_PORT_TRANSACTION=6543

# 📌 每个池的最大 PostgreSQL 连接数
# 用于: supavisor服务限制对数据库的连接数
POOLER_DEFAULT_POOL_SIZE=20

# 📌 每个池的最大客户端连接数
# 用于: supavisor服务限制客户端连接数
POOLER_MAX_CLIENT_CONN=100

# 📌 租户标识符
# 用于: supavisor服务识别租户
POOLER_TENANT_ID=your-tenant-id

# 📌 Supavisor 内部元数据存储的连接池大小
# 用于: supavisor服务自身的数据库操作
POOLER_DB_POOL_SIZE=5


############
# 🌐 API 代理 - Kong 反向代理配置
# Kong 是 Supabase 的 API 网关，所有外部请求都通过它路由
############

# 📌 Kong HTTP 端口（主要的 API 入口）
# 用于: kong服务暴露给外部的 HTTP 端口
# 🌐 外部访问: 客户端通过 host:8000 访问所有 Supabase API
# 🔧 Nginx 配置: 如果使用 Nginx 反向代理，将请求转发到此端口
KONG_HTTP_PORT=8000

# 📌 Kong HTTPS 端口
# 用于: kong服务暴露给外部的 HTTPS 端口
# 🌐 外部访问: 客户端通过 host:8443 访问所有 Supabase API（HTTPS）
KONG_HTTPS_PORT=8443


############
# 📡 PostgREST API 配置
# PostgREST 将 PostgreSQL 数据库暴露为 RESTful API
############

# 📌 暴露的数据库 Schema
# 用于: rest服务决定哪些 Schema 可以通过 REST API 访问
PGRST_DB_SCHEMAS=public,storage,graphql_public


############
# 🔐 Auth 认证配置 - GoTrue 认证服务器
# 处理用户注册、登录、密码重置等认证功能
############

## 通用配置

# 📌 站点 URL（用户注册/登录后的重定向目标）
# 用于: auth服务生成回调 URL
# 🔧 生产环境: 改为 https://your-app-domain.com
SITE_URL=http://localhost:3010

# 📌 额外允许的重定向 URL（多个用逗号分隔）
# 用于: auth服务验证 OAuth 回调 URL 是否合法
# 🔧 生产环境: 添加所有合法的回调 URL
ADDITIONAL_REDIRECT_URLS=http://localhost:3010/auth/callback,http://localhost:3010/reset-password

# 📌 JWT Token 过期时间（秒）
# 用于: auth服务签发的 JWT 过期时间, rest服务验证 JWT
JWT_EXPIRY=3600

# 📌 是否禁用注册功能
# 用于: auth服务控制是否允许新用户注册
DISABLE_SIGNUP=false

# 📌 外部 API URL（用于生成验证邮件中的链接）
# 用于: auth服务生成邮件验证链接的基础 URL
# 🌐 必须是客户端能够访问的地址（通过 Kong）
# 🔧 生产环境: 改为 https://api.your-domain.com 或带域名的地址
API_EXTERNAL_URL=http://localhost:8000

## 邮件路径配置

# 📌 邮件验证/恢复等操作的 URL 路径
# 用于: auth服务生成邮件中的验证链接路径
MAILER_URLPATHS_CONFIRMATION="/auth/v1/verify"
MAILER_URLPATHS_INVITE="/auth/v1/verify"
MAILER_URLPATHS_RECOVERY="/auth/v1/verify"
MAILER_URLPATHS_EMAIL_CHANGE="/auth/v1/verify"

## 额外的 SMTP 邮件配置
# 用于: auth服务的邮件功能
GOTRUE_MAILER_AUTOCONFIRM=false
GOTRUE_MAILER_URLPATHS_CONFIRMATION="${API_EXTERNAL_URL}${MAILER_URLPATHS_CONFIRMATION}"
GOTRUE_MAILER_URLPATHS_RECOVERY="${API_EXTERNAL_URL}${MAILER_URLPATHS_RECOVERY}"

## 邮箱认证配置

# 📌 是否允许邮箱注册
# 用于: auth服务控制邮箱注册开关
# 🔧 生产环境: 根据需求设置
ENABLE_EMAIL_SIGNUP=true

# 📌 是否自动确认邮箱（跳过验证邮件）
# 用于: auth服务控制是否需要邮箱验证
# 🔧 生产环境: 建议设为 false，要求用户验证邮箱
ENABLE_EMAIL_AUTOCONFIRM=false

# 📌 SMTP 管理员邮箱
# 用于: auth服务发送邮件时的管理员邮箱
# 🔧 生产环境: 改为公司邮箱如 admin@yourcompany.com
SMTP_ADMIN_EMAIL=admin@example.com

# 📌 SMTP 服务器地址
# 用于: auth服务发送邮件的 SMTP 服务器
# 🔧 生产环境: 改为 mail.yourcompany.com 或内部邮件服务器 IP
SMTP_HOST=host.docker.internal

# 📌 SMTP 服务器端口
# 用于: auth服务连接 SMTP 服务器的端口
# 🔧 生产环境: 改为 25 (SMTP) 或 587 (SMTP with STARTTLS) 或 465 (SMTPS)
SMTP_PORT=1025

# 📌 SMTP 用户名
# 用于: auth服务登录 SMTP 服务器
# 🔧 生产环境: 改为邮件服务器用户名，如 your-app@yourcompany.com
SMTP_USER=

# 📌 SMTP 密码
# 用于: auth服务登录 SMTP 服务器
# 🔧 生产环境: 设置邮件服务器密码
SMTP_PASS=

# 📌 发件人名称
# 用于: auth服务发送邮件时显示的发件人名称
# 🔧 生产环境: 改为应用名称如 Your App Name
SMTP_SENDER_NAME=fake_sender

# 📌 发件人邮箱
# 用于: auth服务发送邮件时的发件人地址
# 🔧 生产环境: 改为 no-reply@yourcompany.com
SMTP_SENDER_EMAIL=admin@example.com

# 📌 邮件发送频率限制
# 用于: auth服务限制邮件发送频率
SMTP_MAX_FREQUENCY=1s

# 📌 是否允许匿名用户
# 用于: auth服务控制是否允许匿名登录
ENABLE_ANONYMOUS_USERS=false

## 手机认证配置

# 📌 是否允许手机注册
# 用于: auth服务控制手机注册开关
ENABLE_PHONE_SIGNUP=true

# 📌 是否自动确认手机号
# 用于: auth服务控制是否需要短信验证
ENABLE_PHONE_AUTOCONFIRM=true


############
# 🖥️ Studio 仪表板配置
# Supabase Studio 是可视化管理界面
############

# 📌 默认组织名称
# 用于: studio服务显示的默认组织名
STUDIO_DEFAULT_ORGANIZATION=Default Organization

# 📌 默认项目名称
# 用于: studio服务显示的默认项目名
STUDIO_DEFAULT_PROJECT=Default Project

# 📌 Supabase 公开 URL（Studio 用于显示连接信息）
# 用于: studio服务显示的公开访问 URL
# 🔧 生产环境: 改为实际的公开访问地址 https://api.your-domain.com
SUPABASE_PUBLIC_URL=http://localhost:8000

# 📌 是否启用 WebP 图片检测
# 用于: imgproxy服务的图片处理
IMGPROXY_ENABLE_WEBP_DETECTION=true

# 📌 OpenAI API Key（可选，用于 SQL 编辑器助手）
# 用于: studio服务的 AI 辅助功能
OPENAI_API_KEY=


############
# ⚡ Edge Functions 配置
############

# 📌 是否验证 Edge Functions 的 JWT
# 用于: functions服务控制是否验证请求的 JWT
# ⚠️ 此设置应用于所有函数，暂不支持单独配置
FUNCTIONS_VERIFY_JWT=false


############
# 📊 日志分析配置
# Logflare 提供日志收集和分析功能
############

# 📌 Logflare 公开访问 Token
# 用于: analytics服务, vector服务, studio服务的日志访问
LOGFLARE_PUBLIC_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-public

# 📌 Logflare 私有访问 Token
# 用于: analytics服务, studio服务的日志管理
# ⚠️ 不能与 PUBLIC_ACCESS_TOKEN 相同
LOGFLARE_PRIVATE_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-private

# 📌 Docker Socket 位置（用于收集容器日志）
# 用于: vector服务读取 Docker 容器日志
# 🔧 不同操作系统可能不同
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# Google Cloud 项目配置（使用 BigQuery 后端时需要）
GOOGLE_PROJECT_ID=GOOGLE_PROJECT_ID
GOOGLE_PROJECT_NUMBER=GOOGLE_PROJECT_NUMBER


############
# 🚀 PromptMinder 应用配置
############

# 📌 认证密钥（至少32字符）
# 用于: web应用的 session 加密
AUTH_SECRET=your-auth-secret-key-min-32-chars

# 📌 管理员用户名列表（多个用逗号分隔）
# 用于: web应用识别管理员用户
ADMIN_USERNAMES=xx@gmail.com,zhang@aa.aa

# 📌 应用基础 URL
# 用于: web应用生成链接、重定向等
# 🔧 生产环境: 改为 https://your-app-domain.com
NEXT_PUBLIC_BASE_URL=http://localhost:3010


############
# 🤖 AI 服务配置
# 用于 Prompt 优化和测试功能
############

# 📌 自定义 AI API Key
# 用于: web应用调用 AI 服务
CUSTOM_API_KEY=sk-xx

# 📌 自定义 AI API URL
# 用于: web应用调用 AI 服务的端点
CUSTOM_API_URL=https://xx.ai/v1

# 📌 模型名称列表（多个用逗号分隔，第一个为默认）
# 用于: web应用的模型选择
# 示例: CUSTOM_MODEL_NAME=deepseek-v3,gpt-4o-mini,claude-3-haiku
CUSTOM_MODEL_NAME=deepseek-v3,claude-haiku-4-5-20251001


############
# 🔑 Supabase 客户端配置
# 这些是给 PromptMinder 应用使用的 Supabase 连接配置
############

# 重复定义以确保兼容性
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzY1NjM0MDMyLCJleHAiOjE3OTcxNzAwMzJ9.EY31L6e8y5KYrnwQ5zRVhK415wY_lb8Mu1BwVd88BV0
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoic2VydmljZV9yb2xlIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NjU2MzQwMzIsImV4cCI6MTc5NzE3MDAzMn0.CicU89LY8wgYgP6yAldIfveaqHZ1FQxD1hqfnaQ7YVc

# 📌 兼容性变量（保留旧变量名）
# 用于: web应用的 Supabase 客户端
SUPABASE_ANON_KEY=${ANON_KEY}
SUPABASE_SERVICE_ROLE_KEY=${SERVICE_ROLE_KEY}

# 📌 Supabase URL（服务端使用）
# 用于: web应用服务端连接 Supabase
# ⚠️ Docker 环境下改为 http://kong:8000
SUPABASE_URL=http://localhost:8000

# 📌 客户端 Supabase 配置（浏览器端使用）
# 用于: web应用客户端 JS 连接 Supabase Auth
# 🔧 生产环境: 改为公开可访问的地址
NEXT_PUBLIC_SUPABASE_URL=http://localhost:8000
NEXT_PUBLIC_SUPABASE_ANON_KEY=${ANON_KEY}


############
# 🎛️ Supabase Studio 代理配置
############

# 📌 Studio 内部 URL
# 用于: web应用代理访问 Studio
# ⚠️ Docker 环境下通常是 http://studio:54323
SUPABASE_STUDIO_URL=http://localhost:54323

# 📌 管理员 Token 过期时间（毫秒）
# 用于: web应用的管理员 Token 有效期
ADMIN_TOKEN_EXPIRY_MS=86400000

# 📌 代理速率限制（每分钟请求数）
# 用于: web应用限制对 Studio 代理的请求频率
SUPABASE_PROXY_RATE_LIMIT=100

# 📌 CORS 允许的源（多个用逗号分隔）
# 用于: web应用的 CORS 配置
# 🔧 生产环境: 添加所有需要访问 API 的域名
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3010

# 📌 审计日志 Webhook URL（可选）
# LOG_WEBHOOK_URL=https://your-log-service.com/webhook


############
# 🏷️ 站点标识配置
# 用于自定义 PromptMinder 应用的品牌外观
############

# 📌 应用名称
# 用于: web应用显示的标题
NEXT_PUBLIC_APP_NAME=xx PromptMinder

# 📌 Favicon 路径
# 用于: web应用的浏览器图标
NEXT_PUBLIC_APP_FAVICON=/favicon.ico

# 📌 Logo 路径
# 用于: web应用的 Logo 图片
NEXT_PUBLIC_APP_LOGO=/LOGO3.png

# 📌 Logo 尺寸
# 用于: web应用 Logo 的显示大小
NEXT_PUBLIC_APP_LOGO_WIDTH=100
NEXT_PUBLIC_APP_LOGO_HEIGHT=50

# 📌 应用描述
# 用于: web应用的 SEO 描述
NEXT_PUBLIC_APP_DESCRIPTION="Make AI prompt management simpler and more efficient..."

# 📌 邮箱域名限制（多个域名用逗号分隔）
# 用于: web应用限制只允许特定域名的邮箱注册
# 🔧 生产环境: 改为公司域名如 yourcompany.com
NEXT_PUBLIC_ALLOWED_EMAIL_DOMAINS=gmail.com


############
# 📧 企业邮件服务配置 (Email Hook)
# 注意: 邮件配置现在在 PostgreSQL 函数中
# 请修改 volumes/db/email-hook.sql 中的配置
############

# 📌 Supabase Auth 验证 URL（用于邮件中的验证链接）
# 用于: postgres数据库中 email-hook 函数生成验证链接
# 🔧 生产环境: 改为 https://api.your-domain.com
SUPABASE_AUTH_URL=http://your-supabase-host:8000

# 📌 企业邮件 REST API 地址
# 用于: postgres数据库中 email-hook 函数调用邮件服务
# 🔧 生产环境: 改为实际的邮件 API 地址
EMAIL_API_URL=http://your-email-api-host:8081/message/normal/no-attach


############
# 📋 端口总结（部署时需要关注的端口）
############
#
# 🌐 对外暴露的端口（需要在防火墙/Nginx 配置）:
#   - KONG_HTTP_PORT (8000): 主 API 入口，所有 Supabase API 都通过此端口
#   - KONG_HTTPS_PORT (8443): HTTPS API 入口
#   - POSTGRES_PORT (5432): PostgreSQL 数据库（通过 supavisor）
#   - POOLER_PROXY_PORT_TRANSACTION (6543): 数据库连接池（事务模式）
#   - web 服务 (3002): PromptMinder 应用（docker-compose 中硬编码）
#   - analytics 服务 (4000): Logflare 分析服务
#
# 🔧 典型 Nginx 配置示例:
#   - api.your-domain.com -> localhost:8000 (Kong)
#   - app.your-domain.com -> localhost:3002 (PromptMinder)
#
# ⚠️ 修改端口时需要同步修改的配置:
#   - KONG_HTTP_PORT: 需要同步修改 API_EXTERNAL_URL, SUPABASE_PUBLIC_URL
#   - SITE_URL: 需要同步修改 ADDITIONAL_REDIRECT_URLS
#   - 所有 localhost 引用在生产环境需要改为实际域名
#