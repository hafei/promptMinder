# 管理员系统使用指南

## 环境变量配置

在 `.env` 文件中设置超级管理员：

```bash
# 超级管理员配置（多个用逗号分隔）
ADMIN_USERNAMES=admin,yourname@company.com

# 支持两种格式：
# 1. 用户名前缀 - admin 会匹配 admin@example.com, admin@domain.com 等
# 2. 完整邮箱 -精确匹配 yourname@company.com
```

## 使用步骤

### 1. 设置初始超级管理员

编辑 `.env` 文件：
```bash
ADMIN_USERNAMES=yourusername
```

### 2. 重启应用

重启应用以加载新的环境变量配置。

### 3. 登录并访问管理后台

1. 使用超级管理员账户登录（/sign-in）
2. 访问 `/admin/contributions` 查看贡献审核
3. 访问 `/admin/users` 管理用户权限

### 4. 添加其他管理员

在 `/admin/users` 页面：
1. 找到要设置为管理员的用户
2. 点击开关切换其管理员状态
3. 普通管理员获得基本管理权限（如审核贡献）
4. 只有超级管理员可以设置其他用户的管理员权限

## 权限说明

- **超级管理员**
  - 在 ADMIN_USERNAMES 中配置
  - 可以管理所有用户的管理员权限
  - 访问所有管理功能

- **普通管理员**
  - 由超级管理员设置
  - 可以审核贡献
  - 不能设置其他用户的管理员权限

## 用户角色显示

在用户管理页面中，用户角色有不同的视觉区分：

- **超级管理员** (红色徽章，皇冠图标)
  - 在 ADMIN_USERNAMES 中配置
  - 不能被取消管理员权限
  - 显示"超级管理员"标签

- **管理员** (橙色徽章，盾牌图标)
  - 由超级管理员设置
  - 可以通过开关切换权限
  - 显示"管理员"标签

- **普通用户** (灰色边框徽章，用户图标)
  - 没有管理权限
  - 可以被设置为管理员
  - 显示"普通用户"标签

## 权限生效机制

### 授权（设置为管理员）
1. 管理员权限更新后，用户需要**刷新会话**或**重新登录**
2. 点击"刷新会话"按钮会获取包含最新权限的新 token
3. 用户可以立即访问管理后台

### 撤销权限（取消管理员）
1. 取消管理员权限时，系统会自动**使该用户的所有会话失效**
2. 该用户需要重新登录后才会失去管理员权限
3. 旧 token 会立即失效，无法继续访问管理后台

## 注意事项

1. 环境变量中的用户名会自动匹配邮箱前缀
2. 用户权限存储在 Supabase Auth 的 user_metadata 中
3. 撤销权限时用户会被强制登出，需要重新登录
4. 确保 ADMIN_USERNAMES 中至少有一个有效的用户
5. 超级管理员不能被取消权限，这是为了防止系统无法管理